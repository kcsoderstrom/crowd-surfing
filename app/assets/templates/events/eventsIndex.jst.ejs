<h2><a class="events" href="#/events" alt="Events"></a>Events</h2>
<a class="button" href="#/events/new">New event</a>

<% var getName = function(user) { return '<a href="#/users/' + user.id + '">' + user.name + "</a>"; } %>
<% console.log("TODO: THIS NEEDS TO BE ESCAPED") %>

<ul>
  <% collection.forEach(function(evt) { %>
    <li data-event-id="<%= evt.id %>">
    <h3><a href="#/events/<%= evt.id %>"><%= evt.escape("title") %></a></h3>
      <ul class="info">
        <% if(evt.get("is_authored")) { %>
          <li>You created this event; double-click properties to edit.</li>
          <li><button class="delete-event">Delete this event</button></li>
        <% } %>
        <li class="attendance">Are you attending? <button class="attendance"><%= evt.get("is_attending") ? "YES" : "NO" %></button></li>
        <li class="time">Happens at this time: <%= evt.get("is_authored") ? "<div>" + evt.get("time") + "</div>" : evt.get("time") %>
                         <% if(evt.get("is_authored")) { %>
                           <input class="hidden time" type="text" value="<%= evt.get("time") %>">
                         <% } %>
        </li>
        <li class="date">Happens on this day: <%= evt.get("is_authored") ? "<div>" + evt.get("date") + "</div>" : evt.get("date") %>
                         <% if(evt.get("is_authored")) { %>
                           <input class="hidden date" type="text" value="<%= evt.get("date") %>">
                         <% } %>
        </li>

        <% if(evt.invitation_receivers && evt.invitation_receivers.length > 0) { %>
          <li>You've invited <%= evt.invitation_receivers.map(getName).join(" and ") %>.</li>
        <% } %>

        <% if(evt.get("received_invitation")) { %>
          <li><%= evt.invitation_senders.map(getName).join(" and ") %> invited you to this event.</li>
        <% } %>

        <% if(evt.get("sent_request")) { %>
          <li>You sent invitation requests to <%= evt.request_receivers.map(getName).join(" and ") %>.</li>
        <% } %>

      </ul>
      <a class="invite transient-friend request-button" href="#">Invite people</a>
    </li>
  <% })  %>
</ul>

<a href="#">Edit</a>
